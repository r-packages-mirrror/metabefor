---
title: "Example metabefor Rmd file"
author: "Gjalt-Jorn Peters"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Example metabefor Rmd file}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r pre-setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
require('metabefor');
### Using a temporary directory in this vignette
workingPath <- tempdir();
```

# Queries

<!--------------------------------------------------------------------->
<!-- Set up of first query (done before the corresponding header, as -->
<!-- the date in that header is read from this object) ---------------->
<!--------------------------------------------------------------------->

```{r query-definition}

###----------------------------------------------------------------------------
### Specify first query
###----------------------------------------------------------------------------

query <-
  query_full(
    inclusion =
      query_requiredConcepts(
        conceptName = "inclusion",
        query_conceptTerms(
          conceptName="fluffiness",
          "fluffy",
          "hairy",
          "soft"),
        query_conceptTerms(
          conceptName="aggression",
          "aggressi*",
          "predator*",
          "kill*")),
    exclusion = 
      query_conceptTerms(
        conceptName = "exclude non-empirical work",
        "review",
        "meta-analysis"));

### Note that PsycINFO subsumes PsycARTICLES, and PubMed subsumes MEDLINE (see
### "Is PsycARTICLES cross-linked with any outside databases or journals?" at
### http://www.apa.org/pubs/databases/psycarticles/faq.aspx for PsycINFO and
### and http://askus.library.tmc.edu/faq/2018 for MEDLINE

###----------------------------------------------------------------------------
### Specify screening exclusion criteria - should correspond to query concepts
###----------------------------------------------------------------------------

exclusion <-
  exclusion_criteria(notEmpirical = "Not an empirical study (e.g. a review or debate paper)",
                     notFluffy = "Fluffiness is not assessed");

```

```{r specify-search-1}

searches <- list();
searches[[1]] <-
  specify_search(date = "2019-03-03",
                 query = query,
                 databases = list(psycinfo = list(interface = "ebsco",
                                                  fileFormat = "ris"),
                                  pubmed = list(interface= "pubmed",
                                                fileFormat = "ris")),
                 fields = "title");

```

## First search, executed at: `r searches[[1]]$date;`

The query used in this search is:

```{r search-1-query-figure-show, echo=TRUE, eval=FALSE}
plot(searches[[1]]$query);
```

```{r search-1-figure-export, screenshot.force=FALSE, fig.height=5, echo=FALSE}
### Saving file as .png and including it afterwards to show it on
### GitHub preview
#forExport <- data.tree::ToDiagrammeRGraph(searches[[1]]$query);
#search1query_export <- file.path(workingPath, "search-1-query.png");
#DiagrammeR::export_graph(forExport,
#                         search1query_export);
```

    Temporarily removed figure until I get V8 to work in GitLab CI.

<!-- ![Figure 1: Conceptual visualisation of the query used in search 1.](`r #search1query_export`) -->

In this query, the searched terms must occur in entries' `r searches[[1]]$fields` fields.

```{r search-1-convert-to-interface-languages, echo=TRUE, eval=TRUE}
query_toInterfaceLang(searches[[1]]$query,
                      fields=searches[[1]]$fields,
                      exclude=searches[[1]]$exclude);
```

